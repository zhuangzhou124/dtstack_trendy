


select t1.orderCreateTime,
			 t1.orderCreateDate,
			 t1.date_type,
			 t1.date_id,
			 t1.payTime,
			 t1.salesOrderNo,
			 t1.ecId,
			 t1.outerOrderNo,
			 t1.orderTypeText,
			 t1.omsOrderNo,
			 t1.trackingNo,
			 t1.territory,
			 t1.cityName,
			 t1.terminalStoreCode,
			 t1.terminalStoreName,
			 t1.storeCate,
			 t1.clerkNo,
			 t1.clerkName,
			 t1.productCode,
			 t1.skuCode,
			 t1.skuName,
			 t1.colorCode,
			 t1.colorName,
			 t1.sizeCode,
			 t1.sizeName,
			 t1.retailPrice,
			 t1.year,
			 t1.season,
			 t1.project,
			 t1.mainCateText,
			 t1.subCateType,
			 t1.leafCate,
			 t1.series,
			 t1.quantity,
			 t1.discountPrice,
			 t1.retailAmount,
			 t1.salesAmount,
			 t1.discountRate,
			 t1.promotionCodes,
			 t1.promotionNames,
			 t1.promotionType,
			 t1.promotionDiscount,
			 t1.originalOrderNo,
			 t1.rmaReason,
			 t1.intervalTimeFromRiginalToRma,
			 t1.rmaContactNumber,
			 t1.brand,
			 t1.listDate,
			 t1.pricePrintTypeText,
			 t1.discountAmount,
			 t2.totalAmountWithoutCash,
			 t2.discountAmountWithCash,
			 t1.rmaTypeText,
			 t1.customerLevelText,
			 t1.vipNo,
			 t1.cashCouponContributionAmount,
			 t1.salesAmountDeductCoupon,
			 t1.salesAmountWithCoupon,
			 t1.actualAmountDeductCoupon,
			 t1.actualAmountWithCoupon,
			 t1.originalAuditDate,
			 t2.totalAmount,
			 t1.salesOrderItemNo,
			 t1.couponNo,
			 t1.couponName,
			 t1.couponType,
			 t1.isDonate,
			 t1.vipId,
			 t1.memberPhone,
			 t1.isWipeZero,
			 t1.subBrandName,
			 t1.promotionDiscountPoints,
			 t1.memberUnionId,
			 t1.storedValueCardPayAmount
from
(SELECT order_create_time AS orderCreateTime,
				order_create_date AS orderCreateDate,
				pay_time AS date_type,
				audit_time AS date_id,
				audit_date AS payTime,
				sales_order_no AS salesOrderNo,
				ec_id AS ecId,
				outer_order_no AS outerOrderNo,
				order_type AS orderTypeText,
				oms_order_no AS omsOrderNo,
				tracking_no AS trackingNo,
				region_name AS territory,
				city_name AS cityName,
				channel_endpoint AS terminalStoreCode,
				endpoint_name AS terminalStoreName,
				channel_endpoint_type AS storeCate,
				clerk_no AS clerkNo,
				clerk_name AS clerkName,
				sku_product_code AS productCode,
				sku_code AS skuCode,
				sku_name AS skuName,
				sku_color_code AS colorCode,
				sku_color_name AS colorName,
				sku_size_code AS sizeCode,
				sku_size_name AS sizeName,
				sku_retail_price AS retailPrice,
				sku_year AS YEAR,
				sku_season AS season,
				sku_band AS PROJECT,
				sku_main_cate AS mainCateText,
				sku_sub_cate AS subCateType,
				sku_leaf_cate AS leafCate,
				sku_series AS series,
				sku_num AS quantity,
				sku_discount_price AS discountPrice,
				sku_retail_amt AS retailAmount,
				sku_sales_amt AS salesAmount,
				sku_discount_rate AS discountRate,
				promotion_codes AS promotionCodes,
				promotion_names AS promotionNames,
				promotion_type AS promotionType,
				promotion_discount AS promotionDiscount,
				original_order_no AS originalOrderNo,
				rma_reason AS rmaReason,
				interval_time_from_riginal_to_rma AS intervalTimeFromRiginalToRma,
				rma_contact_number AS rmaContactNumber,
				org_code AS brand,
				sku_list_date AS listDate,
				price_print_type_text AS pricePrintTypeText,
				discount_amt_order AS discountAmount,
				rma_type AS rmaTypeText,
				member_grade_code AS customerLevelText,
				member_no AS vipNo,
				sku_cash_contribution_amt AS cashCouponContributionAmount,
				sales_amt_deduct_coupon AS salesAmountDeductCoupon,
				sales_amt_with_coupon AS salesAmountWithCoupon,
				actual_amt_deduct_coupon AS actualAmountDeductCoupon,
				actual_amt_with_coupon AS actualAmountWithCoupon,
				original_audit_date AS originalAuditDate,
				sales_order_item_no AS salesOrderItemNo,
				coupon_no AS couponNo,
				coupon_name AS couponName,
				coupon_type AS couponType,
				is_donate AS isDonate,
				member_id AS vipId,
				member_phone AS memberPhone,
				is_wipe_zero AS isWipeZero,
				brand_name AS subBrandName,
				promotion_discount_points AS promotionDiscountPoints,
				member_union_id AS memberUnionId,
				stored_value_card_pay_amt AS storedValueCardPayAmount
 FROM ads_api_tpos_tdrp_wfx_sku_channel_endpoint_brand_15mm
 WHERE date_type = ${date_type}
AND date_id = ${date_id}
AND sku_product_code = ${productCode}
AND member_no = ${vipNo}
AND sku_year = ${YEAR}
AND member_grade_code IN ${customerLevelText}
AND member_type IN ${customerTypeList}
AND sku_code IN ${skuCodeList}
AND sku_band IN ${PROJECTS}
AND org_code = ${org_code}
AND sku_season = ${season}
AND channel_endpoint IN ${storeCodeList}
AND sku_sub_cate = ${subCate}
AND clerk_no = ${clerkNo}
AND sales_order_no = ${salesOrderNo}
AND original_order_no = ${originalOrderNo}
AND business_type IN ${orderTypeList}
AND sales_amt_deduct_coupon >= ${totalAmountFrom}
AND sales_amt_deduct_coupon <= ${totalAmountTo}
AND price_print_type_text IN ${pricePrintTypeTextList} ) as t1
	join
	(select sales_order_no,
					sum(totla_amt_order) as totalAmount,
					sum(total_amt_without_cash) as totalAmountWithoutCash,
					sum(discount_amt_with_cash) as discountAmountWithCash
	 from ads_api_tpos_tdrp_wfx_sku_channel_endpoint_brand_15mm
	 where date_type = ${date_type}
	AND date_id = ${date_id}
	AND sku_product_code = ${productCode}
	AND member_no = ${vipNo}
	AND sku_year = ${YEAR}
	AND member_grade_code IN ${customerLevelText}
	AND member_type IN ${customerTypeList}
	AND sku_code IN ${skuCodeList}
	AND sku_band IN ${PROJECTS}
	AND org_code = ${org_code}
	AND sku_season = ${season}
	AND channel_endpoint IN ${storeCodeList}
	AND sku_sub_cate = ${subCate}
	AND clerk_no = ${clerkNo}
	AND sales_order_no = ${salesOrderNo}
	AND original_order_no = ${originalOrderNo}
	AND business_type IN ${orderTypeList}
	AND sales_amt_deduct_coupon >= ${totalAmountFrom}
	AND sales_amt_deduct_coupon <= ${totalAmountTo}
	AND price_print_type_text IN ${pricePrintTypeTextList}
	group by sales_order_no) as t2
		on t1.salesOrderNo = t2.sales_order_no
